from math import sqrt, ceil

#helpers
def has_numbers(text):
    for c in text:
        if c.isdigit():
            return True
    return False

# === SUBSTITUTION CIPHERS === 
def encode_polybius(text):
    #encodes text with polybius square using the modern latin alphabet

    if has_numbers(text):
        raise ValueError("text should not have digit characters")

    text = text.upper()
    square = "ABCDEFGHIKLMNOPQRSTUVWXYZ"
    r = ""
    for c in text:
        if c in square:
            i = square.index(c)
            r += str(i//5 + 1) + str(i % 5 + 1)
        elif c == "J":
            r += "24"
        else:
            r += c
    return r

def decode_polybius(text):
    square = "ABCDEFGHIKLMNOPQRSTUVWXYZ"
    r = ""
    n = 0
    while n < len(text):
        if text[n].isnumeric():
            i, j = text[n: n+2]
            r += square[(int(i) - 1)*5 + int(j) - 1]
            n += 2
        else:
            r += text[n]
            n += 1
    if "I" in r:
        print("\'J \'may have been overwritten by \'I\', have a closer look human!\n" + r)
    return r


# === TRANSPOSITION CIPHERS ===


def column_transpose(string):
    # Transposes string by the square root of its length (will rjust string so its length is a perfect square as needed)
    side_l = ceil(sqrt(len(string)))
    string = string.ljust(side_l ** 2)
    r = ''
    for i in range(side_l):
        for j in range(side_l):
            r += (string[j * side_l + i])
    return r
    
    
def encode_IRC(n, string):
    #Shifts all nonspace charaacters right by n
    #Then for each word (delimited by space) shift to right by n
    #repeat n times
    #add n to start of string
    
    space_ins = []
    i = 0
    while string.find(" ", i + 1) != -1:
        i = string.find(" ", i + 1)
        space_ins.append(i)

    for _ in range(n):
        string = string.replace(" ", "")
        string = string[-n:] + string[:-n]
        string = list(string)
        for i in space_ins:
            string.insert(i, " ")
        string = "".join(string).split(" ")
        for i, word in enumerate(string):
            sn = n % len(word)
            string[i] = word[-sn:] + word[:-sn]
        string = " ".join(string)

    return str(n) + " "+ string
